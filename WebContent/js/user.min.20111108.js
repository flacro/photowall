function getUserId(){var index=window.location.href.indexOf("?");return window.location.href.substring(index+1);}function attachUpdateTagEvent(){$(".desc .tags input").unbind('focusout').bind('focusout',function(){var $parent=$(this).parent();var tagid=$parent.find('input:hidden').val();$("#updatetagform").attr('action',photowall.oneUserTagAPI(getUserId(),tagid));$("#updatetagtagid").val(tagid);var $tags=$parent.find('input:text');var tag=$($tags[0]).val()+"^%aAfnVNla&^"+$($tags[1]).val();$("#updatetagtag").val(tag);$("#updatetagform").ajaxSubmit({clearForm:true,dataType:'xml',beforeSubmit:function(){},resetForm:true,success:function(xml){}});});}$(function(){var $tags=$(".desc .tags");var $name=$(".desc h2");$.ajax({url:'photowall/users/'+getUserId(),type:'get',dataType:'xml',timeout:1000,success:function(xml){$(xml).find('varkrs').each(function(i){var $this=$(this);var userid=$this.attr('id');$("#addtagform").attr('action','/photowall_tomcat/photowall/users/'+userid+"/tags");$("#addtaguserid").val(userid);var name=$this.attr('name');$name.html(name);var logo=$this.attr('logo');$("section .img").html('<img src=/photowall_tomcat/photowall/photos/'+logo+' />');});}});$.ajax({url:'photowall/users/'+getUserId()+"/tags",type:'get',dataType:'xml',timeout:1000,success:function(xml){$(xml).find('tags tag').each(function(i){var $this=$(this);var tagid=$this.attr('id');var tag=$this.attr('tag');var tagArray=tag.split("^%aAfnVNla&^");$tags.append('<span class=tag>'+'<input type=hidden name=tagid value='+tagid+' />'+'<input type=text name=tag-k class=tag-k value='+tagArray[0]+' />\n'+'<span>:</span>\n'+'<input type=text class=tag-v name=tag-v value='+tagArray[1]+' />\n'+'</span>');});attachUpdateTagEvent();}});var tagk,tagv;function tagHtml(tagk,tagv){return'<span class=tag><input type=text name=tag-k class=tag-k value='+tagk+' />\n<span>:</span>\n'+'<input type=text class=tag-v name=tag-v value='+tagv+' />';}function showWaiting(){$("#addtag div").show();}function addTag(){$("#addtag div").hide();$(".tags").animate({height:'+=34px'},100,function(){$(this).append(tagHtml(tagk,tagv));});attachUpdateTagEvent();}$("#addtag a").click(function(){tagk=$("#addtag-k input").val();tagv=$("#addtag-v input").val();$("#addtagtag").val(tagk+"^%aAfnVNla&^"+tagv);$("#addtagform").ajaxSubmit({clearForm:true,dataType:'xml',beforeSubmit:showWaiting,resetForm:true,success:addTag});return false;});});