;$(function(){var $hover=$("#hover");var $preview=$("#img-preview");var $logohidden=$("#logohidden");var $upload=$(".upload");var $dotPreview=$(".preview");var $desc=$("#desc");var $uploadForm=$("#uploadform");var $basicForm=$("#basicform");var $error=$("#error_article");var $nameerror=$("#username_error");function showFileError(msg){$uploadForm.get(0).reset();$error.html(msg).css('opacity','1.0').animate({height:'+30px',},100,function(){window.setTimeout(function(){$error.animate({opacity:0.1,},300,function(){$(this).animate({height:'-30px',},100);});},3000);});}function filterFiles(files){var result=[];for(var i=0,file;file=files[i];i++){if(file.type.indexOf("image")==0){if(file.size>=2048000){showFileError('The file is too large(>2MB).');}else{result.push(file);}}else{showFileError(file.name+' is not an image!');}}return result;}function showWaiting(){$hover.show();}function showPreview(responseXML){console.log(responseXML);$(responseXML).find('image').each(function(i){var $this=$(this);var name=$this.attr('name');$logohidden.val(name);var $person='<img '+'src='+photowall.allPhotosAPI()+'/'+name
+' />';$preview.html($person);});$upload.fadeOut(1000,function(){$hover.hide();$dotPreview.fadeIn(1000,function(){$(this).children("article").animate({left:'0px',opacity:1},300,function(){$desc.fadeIn(200);});});});}function showUploadError(){$error.html('Server failed... Just try later.').animate({height:'+30px',},100,function(){window.setTimeout(function(){$error.animate({opacity:0.1,},300,function(){$(this).animate({height:'-30px',},100);});},5000);});}$("#choosefile").change(function(event){if(filterFiles(event.target.files||event.dataTransfer.files).length>0){$uploadForm.ajaxSubmit({clearForm:true,dataType:'xml',beforeSubmit:showWaiting,resetForm:true,success:showPreview,error:showUploadError});};});$("#reupload").click(function(){$desc.fadeOut(100,function(){$preview.animate({left:"+400px",opacity:0.1},200,function(){$(this).parent().fadeOut(300,function(){$upload.fadeIn(400);});});});return false;});function checkForm(){if($('input[name="username"]').val().trim()===''){$nameerror.html("Can't be null.");window.setTimeout(function(){$nameerror.html("");},2000);return false;}return true;}function redirect(responseXML){var userid=null;$(responseXML).find('varkrs').each(function(i){userid=$(this).attr('id');});window.location.href="user.html?"+userid;}$("#saveperson").click(function(){if(checkForm()){$basicForm.ajaxSubmit({clearForm:true,dataType:'xml',success:redirect,error:showUploadError});}return false;});});